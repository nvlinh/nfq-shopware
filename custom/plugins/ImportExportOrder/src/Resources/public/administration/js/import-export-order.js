(this.webpackJsonp=this.webpackJsonp||[]).push([["import-export-order"],{"/7VB":function(e,t,r){var o=r("VeoN");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);(0,r("SZ7m").default)("3ca5ff7c",o,!0,{})},"404B":function(e,t,r){var o=r("uJvX");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);(0,r("SZ7m").default)("1774e23a",o,!0,{})},INUm:function(e,t,r){},N1NI:function(e,t){e.exports='{% block invoice_export_create %}\n    <sw-page class="import-export-order">\n        <template slot="content">\n            <sw-card-view slot="content">\n                {% block sw_import_export_tabs %}\n                    <sw-tabs>\n                        {% block sw_import_export_tabs_import %}\n                            <sw-tabs-item :route="{ name: \'import.export.order.index.import\' }">\n                                {{  $tc(\'sw-import-export.page.importTab\')  }}\n                            </sw-tabs-item>\n                        {% endblock %}\n\n                        {% block sw_import_export_tabs_export %}\n                            <sw-tabs-item :route="{ name: \'import.export.order.index.export\' }">\n                                {{  $tc(\'sw-import-export.page.exportTab\')  }}\n                            </sw-tabs-item>\n                        {% endblock %}\n                    </sw-tabs>\n                {% endblock %}\n\n                <router-view ref="tabContent"></router-view>\n            </sw-card-view>\n        </template>\n    </sw-page>\n\n{% endblock %}\n'},NWrg:function(e,t){e.exports='{% block sw_import_export_view_export %}\n    <div class="sw-import-export-view-export">\n        <sw-card-view :isLoading="exportRunning">\n            <sw-card :title="$t(\'application.export.sectionLabel\')">\n\n                <sw-datepicker\n                    id="from-date"\n                    v-model="fromDate"\n                    :label="$t(\'application.export.fromDateLabel\')"/>\n\n                <sw-datepicker\n                    id="to-date"\n                    v-model="toDate"\n                    :label="$t(\'application.export.toDateLabel\')"/>\n\n                <sw-container columns="1fr 1fr">\n                    <div>\n                        <sw-button variant="primary" @click="startExport">\n                            {{ $t(\'application.buttons.startExportLabel\') }}\n                        </sw-button>\n                    </div>\n                    <div class="last-export--container">\n                        <p>{{ $t(\'application.export.lastExportLabel\') }}\n                            : {{ new Date(lastExportAt).toLocaleDateString() }}</p>\n                    </div>\n                </sw-container>\n            </sw-card>\n        </sw-card-view>\n    </div>\n{% endblock %}\n'},SHCV:function(e,t,r){"use strict";r.r(t);var o=r("N1NI"),n=r.n(o);r("/7VB");Shopware.Component.register("import-export-order",{template:n.a,metaInfo(){return{title:this.$createTitle()}},created(){this.httpClient=Shopware.Application.getContainer("init").httpClient},methods:{}});var a=r("yPa3"),i=r.n(a);r("YBd/");Shopware.Component.register("import-order-view",{template:i.a,metaInfo(){return{title:this.$createTitle()}},methods:{reloadContent(){this.$refs.activityGrid.fetchActivities()}}});var s=r("NWrg"),p=r.n(s);r("404B");const{Criteria:d}=Shopware.Data;Shopware.Component.register("export-order-view",{template:p.a,inject:["repositoryFactory"],data:()=>({fromDate:new Date("2018-01-01T00:00:00").toISOString(),toDate:(new Date).toISOString(),httpClient:null,lastExportAt:"",errorMessage:null,exportRunning:!1,exportPageIndex:1,exportPageSize:500,exportRows:[]}),metaInfo(){return{title:this.$createTitle()}},methods:{reloadContent(){this.$refs.activityGrid.fetchActivities()},formatDate:e=>"string"==typeof e?e:`${e.getFullYear()}-${`0${e.getMonth()+1}`.slice(-2)}-${e.getDate()}`,formatAddress:e=>[e.street,e.city,e.zipcode,e.country.name].join(", "),csvToString(e,t){let r=[e.join(",")];return t.forEach((e=>{r.push(e.join(","))})),r.join("\n")},generateCsv(){let e=new Blob([this.csvToString(["Order number","Order date","Payment date","Order total","Order status","Payment status","Item number","Item name","Quantity","Item price","VAT rate","Shipping address","Shipping cost","Shipment date","Shipping method chosen","Delivery status","Manufacturer","MPN","EAN"],this.exportRows)],{type:"text/csv;charset=utf8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(e,"order-export.csv");else{let t=document.createElement("a");t.href=URL.createObjectURL(e),t.setAttribute("visibility","hidden"),t.download="order-export.csv",document.body.appendChild(t),t.click(),document.body.removeChild(t)}this.exportRunning=!1},startExport(){console.log("=startExport"),this.exportPageIndex=1,this.exportRows=[],this.exportRunning=!0;const e=new d(this.exportPageIndex,this.exportPageSize);e.addFilter(d.range("orderDate",{gte:this.formatDate(this.fromDate),lte:this.formatDate(this.toDate)})),e.addSorting(d.sort("orderDateTime","DESC")),e.addAssociation("addresses"),e.addAssociation("addresses.country"),e.addAssociation("lineItems"),e.addAssociation("lineItems.product.manufacturer"),e.addAssociation("salesChannel"),e.addAssociation("orderCustomer"),e.addAssociation("currency"),e.addAssociation("transactions"),e.addAssociation("deliveries"),e.addAssociation("deliveries.shippingMethod"),e.addAssociation("deliveries.shippingOrderAddress.country"),e.addAssociation("stateMachineState"),e.getAssociation("transactions").addSorting(d.sort("createdAt"));this.repositoryFactory.create("order").search(e,Shopware.Context.api).then((e=>{let t=0;if(e.forEach((e=>{++t;try{let t=e.deliveries[0],r=e.transactions[0],o=e.stateMachineState;e.lineItems.forEach((n=>{try{let a,i,s,p=n.payload.productNumber||"",d=n.price?n.price.unitPrice:0,c=n.price.taxRules&&n.price.taxRules.length>0&&n.price.taxRules[0]?n.price.taxRules[0].taxRate:0;a=void 0===(n.product&&n.product.manufacturer)?"":n.product.manufacturer.translated.name,i=n.product&&null==n.product.manufacturerNumber||void 0===(n.product&&n.product.manufacturerNumber)?"":n.product.manufacturerNumber,s=n.product&&null==n.product.ean||void 0===(n.product&&n.product.ean)?"":n.product.ean;const l=[e.orderNumber,e.createdAt,r.updatedAt,e.price.totalPrice,o.technicalName,r.stateMachineState.translated.name,p,'"'+n.label+'"',n.quantity,d,c,'"'+this.formatAddress(t.shippingOrderAddress)+'"',e.shippingCosts.totalPrice,"shipped"===t.stateMachineState.technicalName?t.updatedAt:"",t.shippingMethod.translated.name,t.stateMachineState.translated.name,a,i,s];this.exportRows.push(l)}catch(e){console.error("Failed to export line item "+n.payload.productNumber,e)}}))}catch(t){console.error("Failed to export order "+e.orderNumber,t)}})),t<this.exportPageSize)return this.generateCsv();++this.exportPageIndex})).catch((e=>{console.error("Export error",e),this.exportRunning=!1,this.$emit("reset")}))}}});var c=r("SyT4"),l=r("dR2/");Shopware.Module.register("import-export-order",{name:"general.name",type:"plugin",color:"#ff3d58",icon:"default-action-move-file",title:"general.title",description:"general.description",routes:{index:{component:"import-export-order",path:"index",meta:{parentPath:"import-export-order.index"},redirect:{name:"import.export.order.index.import"},children:{import:{component:"import-order-view",path:"import",meta:{parentPath:"import-export-order.index"}},export:{component:"export-order-view",path:"export",meta:{parentPath:"import-export-order.index"}}}}},navigation:[{label:"navigation.label",color:"#ffffff",path:"import.export.order.index",icon:"default-action-move-file",position:100,parent:"sw-order"}],snippets:{"de-DE":c,"en-GB":l}})},SyT4:function(e){e.exports=JSON.parse('{"general":{"name":"Import/Export Order","title":"Import/Export Order","description":"Import/Export orders"},"navigation":{"label":"Import/Export Order"},"application":{"export":{"sectionLabel":"Export","fromDateLabel":"Date from which orders should be exported","toDateLabel":"Date  to which orders should be exported","lastExportLabel":"Last export at"},"buttons":{"startExportLabel":"Export orders","open":"Open","inProgress":"In progress","done":"Done","cancelled":"Cancelled"},"errors":{"noOrdersFound":"No orders found for the chosen timespan!","loadingSettings":"An error occured while loading the settings","savingSettings":"An error occured while saving the settings"}}}')},VeoN:function(e,t,r){},"YBd/":function(e,t,r){var o=r("INUm");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);(0,r("SZ7m").default)("559d0cea",o,!0,{})},"dR2/":function(e){e.exports=JSON.parse('{"general":{"name":"Import/Export Order","title":"Import/Export Order","description":"Import/Export orders"},"navigation":{"label":"Import/Export Order"},"application":{"export":{"sectionLabel":"Export","fromDateLabel":"Start date","toDateLabel":"End date","lastExportLabel":"Last export at"},"buttons":{"startExportLabel":"Export orders","open":"Open","inProgress":"In progress","done":"Done","cancelled":"Cancelled"},"errors":{"noOrdersFound":"No orders found for the chosen timespan!","loadingSettings":"An error occured while loading the settings","savingSettings":"An error occured while saving the settings"}}}')},uJvX:function(e,t,r){},yPa3:function(e,t){e.exports='{% block sw_import_export_view_export %}\n    <div class="sw-import-export-view-export">\n        <sw-card-view>\n{#            <div v-if="errorMessage" class="error--message-container">#}\n{#                <span class="error--message">{{ errorMessage }}</span>#}\n{#            </div>#}\n\n            import content\n        </sw-card-view>\n    </div>\n{% endblock %}\n'}},[["SHCV","runtime","vendors-node"]]]);